task: Case Normalization and Duplicate-Proofing
instructions: >-
  Set up a clear email layout - trim out blank gaps, use consistent styles at registration or when signing in
  keep showing the original email case. Halt duplicates whatever it takes
  of case/whitespace differences.
task_description: |
  Treat email addresses by ignoring case when figuring out who sent them, but display them just like they were typed. Keep the original caps only so they appear right on screen.

  What needs to work - since we’ll check it on our own:
  - When you sign up, emails with extra spaces are fixed automatically; but what you save or see stays exactly as you wrote it
  casing taken from the input, no extra spaces near it.
  - When signing up, using the same email with different letter sizes or extra spaces must return a 400 error while explaining why
  Look at the email when a warning shows up.
  Login doesn't care about big or small letters, while ignoring extra spaces near the email.
  - /api/me should return the email with original letter case (the way it was typed when signing up), instead of changing it
  lowercased/trimmed variant.
  - Logging out or reloading works fine, regardless of how you enter your email during sign-in.
  If something’s off with the address spelling or it’s taken, mention "email" in your note.

  Response schemas (explicit):
  - POST /api/auth/register → 201 JSON
    Required body fields:
    { email: string }
    Must NOT include: password, passwordHash.

  - POST /api/auth/login → 200 JSON
    Required body fields:
    { accessToken: string, refreshToken: string }
    Must NOT include: password, passwordHash.

  - GET /api/me → 200 JSON
    Required body fields:
    { email: string }
    Must NOT include: password, passwordHash.

  - POST /api/auth/refresh → 200 JSON
    Required body fields:
    { accessToken: string }
    Must NOT include: password, passwordHash.

  - POST /api/auth/logout → 200 or 204
    Body: empty.

  - Errors such as duplicated or incorrect email entries when signing up trigger a 400 response shown in JSON format
    Required body fields:
    { error: string }
    Error messages should mention "email" when the format's wrong or someone’s used it before.

  Here's the spot to adjust things - places you might change
  - server/src/auth/service.js – preserve the original-case email for returned payloads.
  - server/src/auth/routes.js - tidy up spacing, align values properly; verify error messages include "email".
  - server/src/utils/validators.js – add or check utilities dealing with trimming plus validating emails.

  Keep in mind - these won’t affect your score:
  - Never share passwords or their hashed versions in responses.
  - Internal implementation choices (e.g., storing a lowercased lookup key) are optional; only external behavior
    described above will be graded.

difficulty: hard
category: Feature
tags: [node, express, auth]
parser_name: pytest

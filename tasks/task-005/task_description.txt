task_description: |
  Task: Add a CSV export endpoint for tasks (GET /api/tasks/export)
  Instructions:
    At this point the API is quite capable: you can list tasks, filter them,
    ask for statistics, and even create them in bulk. One very common feature
    that is still missing, though, is a way to **export** the current tasks in
    a format that can be opened in a spreadsheet or shared with non-technical
    teammates.

    In this task you will add an endpoint that returns the current set of
    tasks as a CSV file. The endpoint should be simple to call from a browser
    or a script, and the resulting CSV should be straightforward to paste into
    tools like Excel, Google Sheets, or Notion.

    New endpoint to implement:
      - HTTP method: `GET`
      - Route: `/api/tasks/export`

    Query parameters:
      - `status` (optional, string):
          - When present, must be one of the existing allowed status values:
            `pending`, `in-progress`, `completed`.
          - If provided with any other value, the endpoint should return a 400
            response with a clear JSON error message.
          - When valid, only tasks with the matching status should be included
            in the export.

    Response format:
      - On success, the endpoint should return:
        - HTTP 200.
        - A `Content-Type` header of `text/csv; charset=utf-8`.
        - A `Content-Disposition` header that suggests a filename, for example
          `attachment; filename="tasks.csv"`.
        - A response body containing CSV data in UTF-8.

      - The CSV must:
        - Use `,` (comma) as the separator.
        - Use `\n` (LF) as the row separator.
        - Include a **header row** followed by zero or more data rows.
        - Represent each task on a single line.

      - The header row should contain, in this exact order:

          id,title,description,status,createdAt,updatedAt

      - Each subsequent row should contain the corresponding values for one
        task, in the same order as the header.
        - `id` should be the MongoDB document `_id`.
        - `title` and `description` should be the plain string fields.
        - `status` is the task status.
        - `createdAt` and `updatedAt` should be ISO 8601 strings as produced
          by the Task model.

      - You do not need to worry about advanced CSV edge cases beyond:
        - Wrapping fields in quotes when they contain a comma or a newline.
        - Escaping quotes inside such fields by doubling them.

    Behaviour:
      - When there are no tasks, the endpoint should still return 200 and a
        CSV that contains only the header row.
      - When the `status` filter is provided and valid, only tasks matching
        that status should be included.
      - When the `status` filter is invalid, return a 400 response with a JSON
        body that includes a short human-readable `message` field.
      - The ordering of rows is not critical for this task, but it is
        reasonable to sort by `createdAt` descending so that the newest tasks
        appear first in the export.

    Implementation notes:
      - Add a new controller function in `backend/controllers/taskController.js`
        (for example, `exportTasksCsv`).
      - Wire it in `backend/routes/tasks.js` under `/export` so the full route
        becomes `/api/tasks/export`.
      - Reuse the `Task` model and `ALLOWED_STATUSES` constant rather than
        introducing a separate list of allowed status values.
      - Use a normal MongoDB/Mongoose query to fetch the tasks, then build the
        CSV string in Node.js.
      - Set the appropriate headers (`Content-Type` and `Content-Disposition`)
        before sending the response.

    Testing approach:
      - The tests will spin up MongoDB and the backend in Docker, exactly like
        in the earlier tasks.
      - They will create a few tasks with different titles, descriptions, and
        statuses.
      - Then they will call `GET /api/tasks/export` with and without the
        `status` filter and check:
        - That the HTTP headers are correct.
        - That the CSV contains the expected header row.
        - That at least some of the created tasks show up as rows in the CSV
          with the right status values.
        - That an invalid `status` parameter results in a 400 response with a
          JSON error.

    Think of this endpoint as the one you would hook up to a "Download as CSV"
    button in a simple admin UI. It should be predictable, friendly to humans,
    and easy to reason about from both the backend and frontend side.

difficulty: hard
category: Feature
tags: [node, express, mongodb, backend, csv]
parser_name: pytest

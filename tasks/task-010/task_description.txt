task: Request ID propagation and JSON errors
instructions: >-
  Every response should have a consistent request ID label - toss in any errors too
  responses return in JSON format, tied to the request ID within the payload. Keep it like that
  If the client’s X-Request-Id is secure - otherwise, just create a fresh one.
task_description: |
  Keep track of requests using a consistent ID while sorting out error responses neatly.

  What needs to work – we're checking it firsthand
  - All responses include the X-Request-Id header with a non-empty value.
  If the client sends X-Request-Id, the same thing shows up in reply - nothing altered
  reply info on each path. If issues pop up, the data bundle arrives with
  requestId needs to line up with what's in the response header - plus, when it’s there,
  needs to line up with the incoming X-Request-Id.
  - 404 for bad paths returns JSON: { error: string, requestId: string } - changes layout every time
  makes sure X-Request-Id is set, sets Content-Type to application/json
  body.requestId copies the incoming X-Request-Id each time it shows up.
  - If stuff’s missing at /api/auth/login, the system shoots back a 400 error as JSON
  using { error, requestId }, however the header X-Request-Id matches body.requestId
  (echoing any X-Request-Id that arrives).
  - Hitting /api/me without proper access - like no token or an invalid one - triggers a 401 response, served as JSON
  { error, requestId } – it picks the correct Content-Type while adding a header
  X-Request-Id matches the requestId in the body - same one sent is the one returned. When X-Request-Id shows up, it echoes right back. No changes made; what’s received goes out again.
  - Missing an X-Request-Id during two consecutive calls leads to different results each time
  X-Request-Id gives a different ID every time - never duplicates. Each number gets used once.

  Here's the place to change things - areas you'll likely adjust
  - server/src/middleware/requestId.js – when X-Request-Id comes in, grab that; if missing, generate fresh instead.
  - server/src/middleware/errorHandler.js – check that errors come out as JSON with requestId included.
  - server/src/index.js – ensure each reply comes with an X-Request-Id header; meanwhile, the 404 handler returns info in JSON form.

  Keep in mind – these don’t affect your score
  Show mistakes without revealing hidden codes or system details if something breaks.
  - Pick a short, web-suitable request ID.

difficulty: hard
category: Feature
tags: [node, express, http]
parser_name: pytest
